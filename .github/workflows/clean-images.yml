#Upon close of PR delete images from ghcr.io registryâ€š
name: clean_images

on: 
  pull_request:
    types: [closed]
 

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:    
    - name: Try delete kuksa.val databroker PR container from GHCR
      uses: bots-house/ghcr-delete-image-action@v1.0.0
      continue-on-error: true
      with:
         owner: eclipse
         name: kuksa.val/databroker
         token: ${{ secrets.PUSH_CONTAINER_TOKEN }}
         tag: pr-${{github.event.pull_request.number}}


    - name: Try delete kuksa.val server PR container from GHCR
      uses: bots-house/ghcr-delete-image-action@v1.0.0
      continue-on-error: true
      with:
         owner: eclipse
         name: kuksa.val/kuksa-val
         token: ${{ secrets.PUSH_CONTAINER_TOKEN }}
         tag: pr-${{github.event.pull_request.number}}


    - name: Try delete kuksa.val client PR container from GHCR
      uses: bots-house/ghcr-delete-image-action@v1.0.0
      continue-on-error: true
      with:
         owner: eclipse
         name: kuksa.val/kuksa-client
         token: ${{ secrets.PUSH_CONTAINER_TOKEN }}
         tag: pr-${{github.event.pull_request.number}}

    - name: Finish
      run: echo "Any temp images in GHCR shall be gone" 
         
